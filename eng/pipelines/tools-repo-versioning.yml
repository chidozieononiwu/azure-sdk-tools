# Tag the tools repos (azure-sdk-tools or azure-sdk-build-tools) to create some form of versioning.
resources:
  repositories:
    - repository: azure-sdk-tools
      type: github
      name: chidozieononiwu/azure-sdk-tools
      endpoint: azure
    - repository: azure-sdk-build-tools
      type: git
      name: playground/azure-sdk-build-tools.chononiw

trigger: none

pr: none

pool:
  vmImage: windows-2019

jobs:
  - job: TagToolsRepo
    displayName: Version Repo with Git Tag

    steps:
    - checkout: self

    - pwsh: |
        $tag = "$(Build.Repository.Name)_$(Build.BuildNumber)"
        $tag = $tag.Substring($tag.IndexOf('/') + 1)

        Write-Host "Tagging $(Build.Repository.Name) with $tag"
        git -c user.name="azure-sdk" -c user.email="azuresdk@microsoft.com" tag -a $tag -m "Append version tag: $tag to $(Build.Repository.Name)"

        $PushURL = "https://$(GitHubPAT-REPO)@github.com/$(Build.Repository.Name).git"
        Write-Host $PushURL
        git push $PushURL origin/master $tag
      workingDirectory: $(Build.SourcesDirectory)