trigger: none
pr: none

variables:
  ParserProject: 'tools/apiview/parsers/csharp-api-parser/CSharpAPIParser.csproj'
  ScriptDirectory: 'tools/apiview/parsers/ConvertTokensToTreeStructure/ConvertTokensToTreeStructure'
  NugetSecurityAnalysisWarningLevel: 'none'

stages:
  - stage: 'CSharpToTreeTokens'
    jobs:
      - job: 'Run'
        timeoutInMinutes: 360

        pool:
          vmImage: 'windows-latest'
          
        steps:
          - script: 'dotnet pack $(ParserProject) -o $(Build.BinariesDirectory)'
            displayName: 'Create C# Parser Tool'
          
          - script: 'ls $(Build.BinariesDirectory)'
            displayName: 'View Output'

          - script: 'dotnet tool install --global --add-source $(Build.BinariesDirectory) --version 1.0.0-dev.20240607.1 CSharpAPIParser'
            displayName: 'Install Parser'

          - script: 'dotnet build $(ScriptDirectory)'
            displayName: 'Build Migration Script'
            env:
              DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
              DOTNET_CLI_TELEMETRY_OPTOUT: 1
              DOTNET_MULTILEVEL_LOOKUP: 0

          - script: 'dotnet run'
            displayName: 'Run Migration Script'
            workingDirectory: $(ScriptDirectory)
            env:
              DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
              DOTNET_CLI_TELEMETRY_OPTOUT: 1
              DOTNET_MULTILEVEL_LOOKUP: 0
              BlobConnectionString: $(BlobConnectionString)
              CosmosConnectionString: $(CosmosConnectionString)
